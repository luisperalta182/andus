{"version":3,"sources":["@wordpress/core-data/src/locks/actions.js"],"names":["__unstableAcquireStoreLock","store","path","exclusive","promise","__unstableEnqueueLockRequest","__unstableProcessPendingLockRequests","notifyAcquired","Promise","resolve","type","request","__unstableReleaseStoreLock","lock","lockRequests","controls","select","STORE_NAME","isAvailable"],"mappings":";;;;;;;;;;AAGA;;AACA;;AAKA;;AATA;AACA;AACA;;AAIA;AACA;AACA;AAGO,UAAUA,0BAAV,CAAsCC,KAAtC,EAA6CC,IAA7C,EAAmD;AAAEC,EAAAA;AAAF,CAAnD,EAAmE;AACzE,QAAMC,OAAO,GAAG,OAAOC,4BAA4B,CAAEJ,KAAF,EAASC,IAAT,EAAe;AACjEC,IAAAA;AADiE,GAAf,CAAnD;AAGA,SAAOG,oCAAoC,EAA3C;AACA,SAAO,MAAM,0CAAwBF,OAAxB,CAAb;AACA;;AAEM,UAAUC,4BAAV,CAAwCJ,KAAxC,EAA+CC,IAA/C,EAAqD;AAAEC,EAAAA;AAAF,CAArD,EAAqE;AAC3E,MAAII,cAAJ;AACA,QAAMH,OAAO,GAAG,IAAII,OAAJ,CAAeC,OAAF,IAAe;AAC3CF,IAAAA,cAAc,GAAGE,OAAjB;AACA,GAFe,CAAhB;AAGA,QAAM;AACLC,IAAAA,IAAI,EAAE,sBADD;AAELC,IAAAA,OAAO,EAAE;AAAEV,MAAAA,KAAF;AAASC,MAAAA,IAAT;AAAeC,MAAAA,SAAf;AAA0BI,MAAAA;AAA1B;AAFJ,GAAN;AAIA,SAAOH,OAAP;AACA;;AAEM,UAAUQ,0BAAV,CAAsCC,IAAtC,EAA6C;AACnD,QAAM;AACLH,IAAAA,IAAI,EAAE,cADD;AAELG,IAAAA;AAFK,GAAN;AAIA,SAAOP,oCAAoC,EAA3C;AACA;;AAEM,UAAUA,oCAAV,GAAiD;AACvD,QAAM;AACLI,IAAAA,IAAI,EAAE;AADD,GAAN;AAGA,QAAMI,YAAY,GAAG,MAAMC,eAASC,MAAT,CAC1BC,gBAD0B,EAE1B,kCAF0B,CAA3B;;AAIA,OAAM,MAAMN,OAAZ,IAAuBG,YAAvB,EAAsC;AACrC,UAAM;AAAEb,MAAAA,KAAF;AAASC,MAAAA,IAAT;AAAeC,MAAAA,SAAf;AAA0BI,MAAAA;AAA1B,QAA6CI,OAAnD;AACA,UAAMO,WAAW,GAAG,MAAMH,eAASC,MAAT,CACzBC,gBADyB,EAEzB,2BAFyB,EAGzBhB,KAHyB,EAIzBC,IAJyB,EAKzB;AACCC,MAAAA;AADD,KALyB,CAA1B;;AASA,QAAKe,WAAL,EAAmB;AAClB,YAAML,IAAI,GAAG;AAAEZ,QAAAA,KAAF;AAASC,QAAAA,IAAT;AAAeC,QAAAA;AAAf,OAAb;AACA,YAAM;AACLO,QAAAA,IAAI,EAAE,oBADD;AAELG,QAAAA,IAFK;AAGLF,QAAAA;AAHK,OAAN;AAKAJ,MAAAA,cAAc,CAAEM,IAAF,CAAd;AACA;AACD;AACD","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { __unstableAwaitPromise } from '@wordpress/data-controls';\nimport { controls } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport { STORE_NAME } from '../name';\n\nexport function* __unstableAcquireStoreLock( store, path, { exclusive } ) {\n\tconst promise = yield* __unstableEnqueueLockRequest( store, path, {\n\t\texclusive,\n\t} );\n\tyield* __unstableProcessPendingLockRequests();\n\treturn yield __unstableAwaitPromise( promise );\n}\n\nexport function* __unstableEnqueueLockRequest( store, path, { exclusive } ) {\n\tlet notifyAcquired;\n\tconst promise = new Promise( ( resolve ) => {\n\t\tnotifyAcquired = resolve;\n\t} );\n\tyield {\n\t\ttype: 'ENQUEUE_LOCK_REQUEST',\n\t\trequest: { store, path, exclusive, notifyAcquired },\n\t};\n\treturn promise;\n}\n\nexport function* __unstableReleaseStoreLock( lock ) {\n\tyield {\n\t\ttype: 'RELEASE_LOCK',\n\t\tlock,\n\t};\n\tyield* __unstableProcessPendingLockRequests();\n}\n\nexport function* __unstableProcessPendingLockRequests() {\n\tyield {\n\t\ttype: 'PROCESS_PENDING_LOCK_REQUESTS',\n\t};\n\tconst lockRequests = yield controls.select(\n\t\tSTORE_NAME,\n\t\t'__unstableGetPendingLockRequests'\n\t);\n\tfor ( const request of lockRequests ) {\n\t\tconst { store, path, exclusive, notifyAcquired } = request;\n\t\tconst isAvailable = yield controls.select(\n\t\t\tSTORE_NAME,\n\t\t\t'__unstableIsLockAvailable',\n\t\t\tstore,\n\t\t\tpath,\n\t\t\t{\n\t\t\t\texclusive,\n\t\t\t}\n\t\t);\n\t\tif ( isAvailable ) {\n\t\t\tconst lock = { store, path, exclusive };\n\t\t\tyield {\n\t\t\t\ttype: 'GRANT_LOCK_REQUEST',\n\t\t\t\tlock,\n\t\t\t\trequest,\n\t\t\t};\n\t\t\tnotifyAcquired( lock );\n\t\t}\n\t}\n}\n"]}